/**
 * Restfull Resources service for AngularJS apps
 * @version v0.7.0 - 2013-05-28
 * @link https://github.com/mgonto/restangular
 * @author Martin Gontovnikas <martin@gonto.com.ar>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(){var t=angular.module("restangular",["ngResource"]);t.provider("Restangular",function(){function t(t){return _.contains(n,t)}function e(t){return _.defaults(t,s)}function r(t,e,r){var n=b[r],i=t;return n&&_.each(n,function(t){i=t(e,i)}),p(i,e,r)}var n=["get","head","options","trace"],i="";this.setBaseUrl=function(t){i=t};var o=[];this.setExtraFields=function(t){o=t};var s={};this.setDefaultHttpFields=function(t){s=t};var a={};this.setDefaultRequestParams=function(t){a=t};var u=[];this.setMethodOverriders=function(t){var e=_.extend([],t);c("delete",e)&&e.push("remove"),u=e};var c=function(t,e){var r=e||u;return!_.isUndefined(_.find(r,function(e){return e.toLowerCase()===t.toLowerCase()}))},d="path";this.setUrlCreator=function(t){if(!_.has(g,t))throw Error("URL Path selected isn't valid");d=t};var h={id:"id",route:"route",parentResource:"parentResource",restangularCollection:"restangularCollection",what:"restangularWhat"};this.setRestangularFields=function(t){h=_.extend(h,t)};var l=function(t){return t};this.setResponseExtractor=function(t){l=t},this.setResponseInterceptor=this.setResponseExtractor;var f=function(t){return t};this.setRequestInterceptor=function(t){f=t};var p=function(t){return t};this.setOnElemRestangularized=function(t){p=t};var v=!0;this.setListTypeIsArray=function(t){v=t};var m=null;this.setRequestSuffix=function(t){m=t};var b={};this.addElementTransformer=function(t,e,r){var n=null,i=null;2===arguments.length?i=e:(i=r,n=e);var o=b[t];o||(o=b[t]=[]),o.push(function(t,e){return _.isNull(n)||t==n?i(e):e})};var g={},y=function(){};y.prototype.parentsArray=function(t){for(var e=[];!_.isUndefined(t);)e.push(t),t=t[h.parentResource];return e.reverse()},y.prototype.resource=function(t,r,n,i){var o=this.base(t);return o+=i[h.what]?"/:"+h.what:"",o+=m||"",r(o,{},{getList:e({method:"GET",params:a,isArray:v,headers:n||{}}),get:e({method:"GET",params:a,isArray:!1,headers:n||{}}),put:e({method:"PUT",params:a,isArray:!1,headers:n||{}}),post:e({method:"POST",params:a,isArray:!1,headers:n||{}}),remove:e({method:"DELETE",params:a,isArray:!1,headers:n||{}}),head:e({method:"HEAD",params:a,isArray:!1,headers:n||{}}),trace:e({method:"TRACE",params:a,isArray:!1,headers:n||{}}),options:e({method:"OPTIONS",params:a,isArray:!1,headers:n||{}}),patch:e({method:"PATCH",params:a,isArray:!1,headers:n||{}})})};var R=function(){};R.prototype=new y,R.prototype.base=function(t){return i+_.reduce(this.parentsArray(t),function(t,e){var r=t+"/"+e[h.route];return e[h.restangularCollection]||(r+="/"+e[h.id]),r},"")},R.prototype.fetchUrl=function(t,e){var r=this.base(t);return e&&e[h.what]&&(r+="/"+e[h.what]),r},g.path=R,this.$get=["$resource","$q",function(e,n){function i(t,e,r){if(e[h.route]=r,e.url=_.bind(H.fetchUrl,H,e),e.addRestangularMethod=_.bind(D,e),t){var n=_.union(_.values(_.pick(h,["id","route","parentResource"])),o);e[h.parentResource]=_.pick(t,n)}return e}function s(t,e,r){var n={};return n[h.id]=r,R(t,n,e)}function a(t,e){return T(t,{},e,!0)}function u(t,e){return t.call=_.bind(p,t),t.get=_.bind(v,t),t[h.restangularCollection]=e,e&&(t.push=_.bind(p,t,"push")),t}function p(t){var e=n.defer(),r=arguments;return this.then(function(n){var i=Array.prototype.slice.call(r,1),o=n[t];o.apply(n,i),e.resolve(n)}),u(e.promise,this[h.restangularCollection])}function v(t){var e=n.defer();return this.then(function(r){e.resolve(r[t])}),u(e.promise,this[h.restangularCollection])}function m(t){return _.omit(t,_.values(_.omit(h,"id")))}function b(t){t.customOperation=_.bind(q,t),_.each(["put","post","get","delete"],function(e){_.each(["do","custom"],function(r){var n=r+e.toUpperCase();t[n]=_.bind(q,t,e)})}),t.customGETLIST=_.bind(A,t),t.doGETLIST=t.customGETLIST}function y(t){var e=angular.copy(t);return R(e[h.parentResource],e,e[h.route])}function R(t,e,n){var o=i(t,e,n);return o[h.restangularCollection]=!1,o.get=_.bind(w,o),o.getList=_.bind(A,o),o.put=_.bind(U,o),o.post=_.bind(I,o),o.remove=_.bind(x,o),o.head=_.bind(O,o),o.trace=_.bind(P,o),o.options=_.bind(S,o),o.patch=_.bind(G,o),o.one=_.bind(s,o,o),o.all=_.bind(a,o,o),b(o),r(o,!1,n)}function T(t,e,n){var o=i(t,e,n);return o[h.restangularCollection]=!0,o.post=_.bind(I,o,null),o.head=_.bind(O,o),o.trace=_.bind(P,o),o.putElement=_.bind(E,o),o.options=_.bind(S,o),o.patch=_.bind(G,o),o.getList=_.bind(A,o,null),b(o),r(o,!0,n)}function C(t){var e={};return t&&(e[h.what]=t),e}function E(t,e,r){var i=this,o=this[t],s=n.defer();return o.put(e,r).then(function(e){var r=y(i);r[t]=e,s.resolve(r)},function(t){s.reject(t)}),u(s.promise,!0)}function A(t,r,i){var o=C(t),s=this,a=n.defer(),c="getList",d=H.fetchUrl(this,o),p=t||s[h.route],v=_.extend(o,r);return f(null,c,p,d),H.resource(this,e,i,v).getList(v,function(e){var r=l(e,c,p,d),n=_.map(r,function(e){return s[h.restangularCollection]?R(null,e,s[h.route]):R(s,e,t)});n=_.extend(r,n),s[h.restangularCollection]?a.resolve(T(null,n,s[h.route])):a.resolve(T(s,n,t))},function(t){a.reject(t)}),u(a.promise,!0)}function L(r,i,o,s){var a=this,d=n.defer(),p=i||{},v=o||this,b=p[h.what]||this[h.route],g=H.fetchUrl(this,p),y=o||m(this);y=f(y,r,b,g);var T=function(t){var e=l(t,r,b,g)||v;"post"!==r||a[h.restangularCollection]?d.resolve(R(a[h.parentResource],e,a[h.route])):d.resolve(R(a,e,p[h.what]))},C=function(t){d.reject(t)},E=r,A=_.extend({},s),L=c(r);return L&&(E="post",A=_.extend(A,{"X-HTTP-Method-Override":r})),t(r)?L?H.resource(this,e,A,p)[E](p,{},T,C):H.resource(this,e,A,p)[E](p,T,C):H.resource(this,e,A,p)[E](p,y,T,C),u(d.promise)}function w(t,e){return _.bind(L,this)("get",t,void 0,e)}function x(t,e){return _.bind(L,this)("remove",t,{},e)}function U(t,e){return _.bind(L,this)("put",t,void 0,e)}function I(t,e,r,n){return _.bind(L,this)("post",_.extend(C(t),r),e,n)}function O(t,e){return _.bind(L,this)("head",t,void 0,e)}function P(t,e){return _.bind(L,this)("trace",t,void 0,e)}function S(t,e){return _.bind(L,this)("options",t,void 0,e)}function G(t,e){return _.bind(L,this)("patch",t,void 0,e)}function q(t,e,r,n,i){return _.bind(L,this)(t,_.extend(C(e),r),i,n)}function D(t,e,r,n,i,o){var s;s="getList"===e?_.bind(A,this,r):_.bind(q,this,e,r),this[t]=function(t,e,r){var a=_.defaults({params:t,headers:e,elem:r},{params:n,headers:i,elem:o});return s(a.params,a.headers,a.elem)}}var H=new g[d],j={};return j.copy=_.bind(y,j),j.one=_.bind(s,j,null),j.all=_.bind(a,j,null),j}]})})();