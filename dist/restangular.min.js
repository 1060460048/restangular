/**
 * Restfull Resources service for AngularJS apps
 * @version v0.2.0 - 2013-04-10
 * @link https://github.com/mgonto/restangular
 * @author Martin Gontovnikas <martin@gonto.com.ar>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
var module=angular.module("restangular",["ngResource"]);module.provider("Restangular",function(){this.baseUrl="",this.setBaseUrl=function(r){this.baseUrl=r},this.extraFields=[],this.setExtraFields=function(r){this.extraFields=r},this.urlCreator="path",this.setUrlCreator=function(t){if(!_.has(r,t))throw Error("URL Path selected isn't valid");this.urlCreator=t};var r={},t=function(r){this.baseUrl=r};t.prototype.base=function(r){return this.baseUrl+_.reduce(this.parentsArray(r),function(r,t){var e=r+"/"+t.route;return t.id&&(e+="/"+t.id),e},"")},t.prototype.parentsArray=function(r){for(var t=[];!_.isUndefined(r);)t.push(r),r=r.parentResource;return t.reverse()},t.prototype.fetchUrl=function(r,t){return this.base(t)+"/"+r.toLowerCase()},t.prototype.resource=function(r,t){return t(this.base(r)+"/:what",{},{getArray:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{},isArray:!1},put:{method:"PUT",params:{},isArray:!1},post:{method:"POST",params:{},isArray:!1},remove:{method:"DELETE",params:{},isArray:!1}})},r.path=t,this.$get=["$resource","$q",function(t,e){function n(r,t,e){return t.route=e,t.getList=_.bind(i,t),t.get=_.bind(o,t),t.put=_.bind(a,t),t.post=_.bind(h,t),t.remove=_.bind(u,t),r&&(t.parentResource=_.pick(r,_.union(["id","route","parentResource"],l))),t}function i(r){var i=r?{what:r}:{},s=this,o=e.defer();return c.resource(this,t).getArray(i,function(t){var e=_.map(t,function(t){return r?n(s,t,r):n(null,t,s.route)});o.resolve(e)},function(){o.reject(arguments)}),o.promise}function s(r,i,s){var o=this,u=e.defer(),a=i||{},h=s||this,l=function(r){r?u.resolve(n(o.parentResource,r,o.route)):u.resolve()},d=function(){u.reject(arguments)};return"get"===r?c.resource(this,t)[r](a,l,d):c.resource(this,t)[r](a,h,l,d),u.promise}function o(r){return _.bind(s,this)("get",r)}function u(r){return _.bind(s,this)("remove",r,{})}function a(r){return _.bind(s,this)("put",r)}function h(r,t){return _.bind(s,this)("post",{what:r},t)}var c=new r[this.urlCreator](this.baseUrl),l=this.extraFields,d={};return d.one=function(r,t){return n(null,{id:t},r)},d.all=function(r){return n(null,{},r)},d}]});