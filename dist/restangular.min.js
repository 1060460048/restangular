/**
 * Restfull Resources service for AngularJS apps
 * @version v0.1.0 - 2013-04-09
 * @link https://github.com/mgonto/restangular
 * @author Martin Gontovnikas <martin@gonto.com.ar>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
var module=angular.module("restangular",["ngResource"]);module.provider("Restangular",function(){this.baseUrl=null,this.setBaseUrl=function(r){this.baseUrl=r},this.extraFields=[],this.setExtraFields=function(r){this.extraFields=r},this.urlCreator="path",this.setUrlCreator=function(e){if(!_.has(r,e))throw Error("URL Path selected isn't valid");this.urlCreator=e};var r={},e=function(r){this.baseUrl=r};e.prototype.base=function(r){return this.baseUrl+_.reduce(this.parentsArray(r),function(r,e){return r+"/"+e.route+"/"+e.id},"")},e.prototype.parentsArray=function(r){for(var e=[];!_.isUndefined(r);)e.push(r),r=r.parentResource;return e.reverse()},e.prototype.fetchUrl=function(r,e){return this.base(e)+"/"+r.toLowerCase()},e.prototype.resource=function(r,e){return e(this.base(r)+"/:what",{},{getArray:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{},isArray:!1},put:{method:"PUT",params:{},isArray:!1},remove:{method:"DELETE",params:{},isArray:!1}})},r.path=e,this.$get=["$resource","$q",function(e,t){function n(r,e,t){return e.route=t,e.fetch=_.bind(s,e),e.get=_.bind(o,e),e.update=_.bind(a,e),e.remove=_.bind(u,e),r&&(e.parentResource=_.pick(r,_.union(["id","route","parentResource"],h))),e}function s(r){var s=this,i=t.defer();return c.resource(this,e).getArray({what:r},function(e){var t=_.map(e,function(e){return n(s,e,r)});i.resolve(t)},function(){i.reject(arguments)}),i.promise}function i(r,s,i){var o=this,u=t.defer(),a=s||{},h=i||this,d=function(r){r?u.resolve(n(o.parentResource,r,o.route)):u.resolve()},f=function(){u.reject(arguments)};return"get"===r?c.resource(this,e)[r](a,d,f):c.resource(this,e)[r](a,h,d,f),u.promise}function o(r){return _.bind(i,this)("get",r)}function u(r){return _.bind(i,this)("remove",r,{})}function a(r){return _.bind(i,this)("put",r)}var c=new r[this.urlCreator](this.baseUrl),h=this.extraFields,d={};return d.create=function(r,e){return n(null,{id:e},r)},d}]});